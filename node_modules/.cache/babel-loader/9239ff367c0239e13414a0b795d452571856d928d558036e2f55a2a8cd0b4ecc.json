{"ast":null,"code":"import axios from \"axios\";\nconst url_api = \"https://pncp.gov.br/api/consulta/v1/contratos\";\nexport const fetchOrgaoInfo = async (cnpj, dataInicial, dataFinal, pagina = 1) => {\n  // Formata as datas no formato yyyyMMdd\n  const formattedDataInicial = dataInicial.replace(/-/g, \"\"); // Ex: 2024-02-09 para 20240209\n  const formattedDataFinal = dataFinal.replace(/-/g, \"\"); // Ex: 2024-08-31 para 20240831\n\n  try {\n    const response = await axios.get(url_api, {\n      params: {\n        cnpj,\n        dataInicial: formattedDataInicial,\n        dataFinal: formattedDataFinal,\n        pagina\n      }\n    });\n    console.log(\"Dados da API\", response.data); // Log da resposta\n\n    // Verifica se a resposta contém dados na estrutura esperada\n    if (!response.data || !Array.isArray(response.data.data) || response.data.data.length === 0) {\n      console.error(\"Nenhum dado encontrado ou resposta inesperada.\");\n      return {\n        orgao: null,\n        contratos: []\n      }; // Retorna se não houver dados\n    }\n\n    // Adquirindo informações do órgão (considerando o primeiro órgão retornado)\n    const orgao = response.data.data[0].orgaoEntidade;\n    const infoOrgao = {\n      razaoSocial: orgao.razaoSocial,\n      cnpj: orgao.cnpj,\n      ufNome: response.data.data[0].unidadeOrgao.ufNome,\n      municipioNome: response.data.data[0].unidadeOrgao.municipioNome\n    };\n\n    // Verifica se os contratos estão disponíveis\n    const contratos = Array.isArray(response.data.data[0].contratos) ? response.data.data[0].contratos.map(item => ({\n      numeroContratoEmpenho: item.numeroContratoEmpenho,\n      dataVigenciaInicio: item.dataVigenciaInicio,\n      dataVigenciaFim: item.dataVigenciaFim,\n      nomeRazaoSocialFornecedor: item.nomeRazaoSocialFornecedor,\n      objetoContrato: item.objetoContrato,\n      valorInicial: item.valorInicial,\n      orgaoEntidade: infoOrgao // Associando o órgão ao contrato\n    })) : []; // Retorna um array vazio se não houver contratos\n\n    return {\n      orgao: infoOrgao,\n      contratos\n    };\n  } catch (error) {\n    console.error(\"Erro na busca de dados do órgão!\", error);\n    if (axios.isAxiosError(error)) {\n      var _error$response;\n      console.error(\"Dados do erro:\", (_error$response = error.response) === null || _error$response === void 0 ? void 0 : _error$response.data);\n      if (error.response) {\n        console.error(\"Status:\", error.response.status);\n        console.error(\"Mensagem:\", error.response.statusText);\n      }\n    } else {\n      console.error(\"Erro desconhecido:\", error);\n    }\n    return {\n      orgao: null,\n      contratos: []\n    }; // Retorna null em caso de erro\n  }\n};","map":{"version":3,"names":["axios","url_api","fetchOrgaoInfo","cnpj","dataInicial","dataFinal","pagina","formattedDataInicial","replace","formattedDataFinal","response","get","params","console","log","data","Array","isArray","length","error","orgao","contratos","orgaoEntidade","infoOrgao","razaoSocial","ufNome","unidadeOrgao","municipioNome","map","item","numeroContratoEmpenho","dataVigenciaInicio","dataVigenciaFim","nomeRazaoSocialFornecedor","objetoContrato","valorInicial","isAxiosError","_error$response","status","statusText"],"sources":["C:/Users/tuliana/orgsearch/src/api/pncpAPI.ts"],"sourcesContent":["import axios from \"axios\";\r\nimport { InfoOrgao, InfoContrato } from \"../tipos/index\";\r\n\r\nconst url_api = \"https://pncp.gov.br/api/consulta/v1/contratos\";\r\n\r\nexport const fetchOrgaoInfo = async (cnpj: string, dataInicial: string, dataFinal: string, pagina: number = 1) => {\r\n    // Formata as datas no formato yyyyMMdd\r\n    const formattedDataInicial = dataInicial.replace(/-/g, \"\"); // Ex: 2024-02-09 para 20240209\r\n    const formattedDataFinal = dataFinal.replace(/-/g, \"\"); // Ex: 2024-08-31 para 20240831\r\n\r\n    try {\r\n        const response = await axios.get<{\r\n            data: {\r\n                orgaoEntidade: InfoOrgao;\r\n                unidadeOrgao: { ufNome: string; municipioNome: string; };\r\n                contratos: InfoContrato[];\r\n            }[];\r\n            totalRegistros: number;\r\n            totalPaginas: number;\r\n            numeroPagina: number;\r\n            paginasRestantes: number;\r\n            empty: boolean;\r\n        }>(url_api, {\r\n            params: {\r\n                cnpj,\r\n                dataInicial: formattedDataInicial,\r\n                dataFinal: formattedDataFinal,\r\n                pagina\r\n            },\r\n        });\r\n\r\n        console.log(\"Dados da API\", response.data); // Log da resposta\r\n\r\n        // Verifica se a resposta contém dados na estrutura esperada\r\n        if (!response.data || !Array.isArray(response.data.data) || response.data.data.length === 0) {\r\n            console.error(\"Nenhum dado encontrado ou resposta inesperada.\");\r\n            return { orgao: null, contratos: [] }; // Retorna se não houver dados\r\n        }\r\n\r\n        // Adquirindo informações do órgão (considerando o primeiro órgão retornado)\r\n        const orgao = response.data.data[0].orgaoEntidade;\r\n        const infoOrgao: InfoOrgao = {\r\n            razaoSocial: orgao.razaoSocial,\r\n            cnpj: orgao.cnpj,\r\n            ufNome: response.data.data[0].unidadeOrgao.ufNome,\r\n            municipioNome: response.data.data[0].unidadeOrgao.municipioNome,\r\n        };\r\n\r\n        // Verifica se os contratos estão disponíveis\r\n        const contratos: InfoContrato[] = Array.isArray(response.data.data[0].contratos)\r\n            ? response.data.data[0].contratos.map((item) => ({\r\n                numeroContratoEmpenho: item.numeroContratoEmpenho,\r\n                dataVigenciaInicio: item.dataVigenciaInicio,\r\n                dataVigenciaFim: item.dataVigenciaFim,\r\n                nomeRazaoSocialFornecedor: item.nomeRazaoSocialFornecedor,\r\n                objetoContrato: item.objetoContrato,\r\n                valorInicial: item.valorInicial,\r\n                orgaoEntidade: infoOrgao, // Associando o órgão ao contrato\r\n            }))\r\n            : []; // Retorna um array vazio se não houver contratos\r\n\r\n        return { orgao: infoOrgao, contratos };\r\n\r\n    } catch (error: unknown) {\r\n        console.error(\"Erro na busca de dados do órgão!\", error);\r\n        if (axios.isAxiosError(error)) {\r\n            console.error(\"Dados do erro:\", error.response?.data);\r\n            if (error.response) {\r\n                console.error(\"Status:\", error.response.status);\r\n                console.error(\"Mensagem:\", error.response.statusText);\r\n            }\r\n        } else {\r\n            console.error(\"Erro desconhecido:\", error);\r\n        }\r\n        return { orgao: null, contratos: [] }; // Retorna null em caso de erro\r\n    }\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}